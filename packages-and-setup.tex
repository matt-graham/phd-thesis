\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{csquotes}
\usepackage[UKenglish]{babel}                  
\usepackage[%
    %backend=biber, %instead of bibtex
	backend=bibtex8,
	bibencoding=ascii,%
	language=auto,%
	style=numeric-comp,%
    %style=authoryear-comp, % Author 1999, 2010
    %bibstyle=authoryear,dashed=false, % dashed: substitute rep. author with ---
    sorting=nyt, % name, year, title
    maxbibnames=10, % default: 3, et al.
    %backref=true,%
    natbib=true % natbib compatibility mode (\citep and \citet still work)
]{biblatex}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{textcomp} % fix warning with missing font shapes
\usepackage{scrhack} % fix warnings when using KOMA with listings package          
\usepackage{xspace} % to get the spacing after macros right  
\usepackage{mparhack} % get marginpar right
\usepackage[printonlyused,smaller]{acronym} % nice macros for handling all acronyms in the thesis
\renewcommand*{\acffont}[1]{\textit{#1}}
\renewcommand*{\acfsfont}[1]{\textnormal{#1}}
\usepackage{tabularx} % better tables
\setlength{\extrarowheight}{3pt} % increase table row height
\newcommand{\tableheadline}[1]{\multicolumn{1}{c}{\spacedlowsmallcaps{#1}}}
\newcommand{\myfloatalign}{\centering} % to be used with each float for alignment
\usepackage{caption}
\captionsetup{font=small} % format=hang,
\usepackage[pdftex,hyperfootnotes=false,pdfpagelabels]{hyperref}  % backref linktocpage pagebackref
\pdfcompresslevel=9
\pdfadjustspacing=1 
\usepackage[pdftex]{graphicx} 
\usepackage{float}
\usepackage{pdflscape}
\usepackage{enumitem}

\newcommand*{\noaddvspace}{\renewcommand*{\addvspace}[1]{}}

\usepackage{multicol}
\usepackage[noend]{algpseudocode}
\usepackage{algorithm}
% smaller line numbers in algorithms
\algrenewcommand\alglinenumber[1]{\tiny #1:}
% redefine presentation of algorithm \Require and \Ensure commands
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\algnewcommand{\IfThenElse}[3]{% \IfThenElse{<if>}{<then>}{<else>}
  \State \algorithmicif\ #1\ \algorithmicthen\ #2\ \algorithmicelse\ #3}
\algnewcommand{\And}{\textbf{and}\xspace}
\algnewcommand{\Or}{\textbf{or}\xspace}  

\usepackage[%
  %drafting, % prints the date and time at the bottom of each page
  %parts, % use part divisions in document (cannot be used with no chapters)
  %nochapters, % use classicthesis styling in document classes without chapters  
  %linedheaders, %
  eulerchapternumbers, %
  %beramono, %
  %eulermath, %
  pdfspacing, %
  %minionprospacing, %
  %tocaligned, %
  %dottedtoc, %
  %manychapters, %
  listings, %
  floatperchapter, %
]{classicthesis}

% Use edited arsclassica styling (no bold fonts, no change to sf font)
\usepackage{arsclassica-alt}

% Use Libertine fonts for text and maths and Bitstream Vera Mono for monospaced
\usepackage[mono=false,proportional]{libertine}
\usepackage[libertine,cmintegrals,cmbraces,libaltvw,slantedGreek]{newtxmath}
\usepackage[scaled=0.8]{beramono}

\makeatletter
\newcommand\libertineTLF{\def\libertine@figurealign{T}\libertineLF}
% \newcommand\libertinePLF{\def\libertine@figurealign{}\libertineLF}    %% not needed
\newcommand\libertineTOsF{\def\libertine@figurealign{T}\libertineOsF}
\newcommand\libertinePOsF{\def\libertine@figurealign{}\libertineOsF}
\makeatother

%% to have proportional old style figures in the main text
\AtBeginDocument{\libertinePOsF}

%% to have tabular figures in all tabulary environments
\usepackage{etoolbox}
\makeatletter
\pretocmd{\TY@tabular}{\libertineTLF}{}{}   %% tabular lining figures
\makeatother

\let\forall\forallAlt

%\usepackage{libertinust1math} % slanted integrals, by default
%\usepackage[cal=stix,scr=boondoxo,bb=boondox]{mathalfa}

\usepackage{mathrsfs}
% https://tex.stackexchange.com/a/23741
\DeclareMathAlphabet{\mathscrbf}{OMS}{mdugm}{b}{n}

%\DeclareFontFamily{U}{px-math-ds}{\skewchar\font=45}% double-struck
%\DeclareFontShape{U}{px-math-ds}{m}{n}{pxr-ds}{}
%\DeclareFontShape{U}{px-math-ds}{b}{n}{pxb-ds}{}
%\DeclareMathAlphabet{\mathbbx}{U}{px-math-ds}{m}{n}
%\usepackage[bb=mma]{mathalfa}

\usepackage{enumitem}
\usepackage{longtable}
\usepackage{nicefrac}

% Use one-and-half line spacing as per University of Edinburgh requirements
\usepackage[onehalfspacing]{setspace}

% Hacky solution to keep margin notes as single-spaced
%\let\prevmarginpar\marginpar
%\renewcommand{\marginpar}[1]{
%  \prevmarginpar{
%    \begin{singlespace}
%      #1
%    \end{singlespace}
%  }
%}

% Change page layout to meet University of Edinburgh requirements
\usepackage{geometry}
\geometry{
  a4paper,
  includehead,
  includemp,
  headsep=5mm,
  %nomarginpar,
  marginparsep=8mm,
  marginparwidth=27mm,
  top=20mm,
  bottom=40mm,
  outer=25mm,
  inner=40mm,
  %showframe
}

% Spaced paragraphs with no initial indent
\usepackage[parfill]{parskip}

\usepackage[subrefformat=parens]{subcaption}

\usepackage{pgfplots}
\usepgfplotslibrary{colorbrewer}
\pgfplotsset{compat=1.5.1}
\usepackage{filecontents}
\usepackage{pgfplotstable}
%\usepackage[table]{xcolor}
\usepgfplotslibrary{groupplots}

\definecolor{edblue}{RGB}{0, 50, 95}
\definecolor{edred}{RGB}{193, 0, 67}
\definecolor{cborange}{RGB}{217,95,2}
\definecolor{cbgreen}{RGB}{27,158,119}
\definecolor{cbviolet}{RGB}{117,112,179}
\definecolor{s3}{RGB}{77, 175, 74}
\definecolor{s4}{RGB}{152, 78, 163}
\definecolor{s5}{RGB}{255, 127, 0}

%\newtheoremstyle{thmstyle}
%  {\topsep} % Space above
%  {\topsep} % Space below
%  {} % Body font
%  {} % Indent amount
%  {\bfseries} % Theorem head font
%  {:} % Punctuation after theorem head
%  {.5em} % Space after theorem head
%  {} % Theorem head spec (can be left empty, meaning `normal')
  
\newtheoremstyle{thmstyle}
  {\parskip} % Space above
  {\parskip} % Space below
  {\itshape} % Body font
  {} % Indent amount
  {} % Theorem head font
  {:} % Punctuation after theorem head
  {.5em} % Space after theorem head
  {\spacedlowsmallcaps{#1}~{\libertinePOsF\textsc{\MakeTextLowercase{#2}}}\thmnote{~(#3)}} % Theorem head spec (can be left empty, meaning `normal')

\theoremstyle{thmstyle} 
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{proposition}{Proposition}
\numberwithin{theorem}{chapter}
\numberwithin{corollary}{chapter}
\numberwithin{proposition}{chapter}

\newtheoremstyle{defstyle}
  {\parskip} % Space above
  {} % Space below
  {\itshape} % Body font
  {} % Indent amount
  {} % Theorem head font
  {:} % Punctuation after theorem head
  {.5em} % Space after theorem head
  {\spacedlowsmallcaps{#1}~{\libertinePOsF\textsc{\MakeTextLowercase{#2}}}\thmnote{~(#3)}} % Theorem head spec (can be left empty, meaning `normal')

%\newtheoremstyle{defstyle}
%{\topsep}{\topsep}%
%{}{}%
%{\bfseries}{}
%{\newline}
%{%
%  \rule{\textwidth}{0.4pt}\\*%
%  \thmname{#1}~\thmnumber{#2}\thmnote{\ -\ #3}.\\*[-1.5ex]%
%  \rule{\textwidth}{0.4pt}
%}%

\theoremstyle{defstyle}

\newtheorem{definition}{Definition}
\numberwithin{definition}{chapter}

\usepackage{tikz}
\usetikzlibrary{bayesnet,arrows,arrows.meta,calc,positioning}

%\usetikzlibrary{external} 
%\tikzexternalize[prefix=tikz-figures/]

% Necessary for correct hyperlinks (to index, bib, etc.)                                  
\newcounter{dummy} 

\newcommand{\ie}{i.\,e.}
\newcommand{\Ie}{I.\,e.}
\newcommand{\eg}{e.\,g.}
\newcommand{\Eg}{E.\,g.} 

% Unnumbered front-matter sections with TOC entries
\newcommand{\frontmattersection}[1]{
  \refstepcounter{dummy}
  \section*{#1}
  \addcontentsline{toc}{section}{#1}
}

\renewcommand\formatchapter[1]{%
    \setbox0=\hbox{\chapterNumber\thechapter\hspace{10pt}\vline\ }%
    \begin{minipage}[t]{\dimexpr\linewidth-\wd0\relax}%
    \raggedright\spacedallcaps{#1}%
    \end{minipage}%
}

% draw binary grid https://tex.stackexchange.com/a/123728

\makeatletter
\tikzset{
    zero color/.initial=white,
    zero color/.get=\zerocol,
    zero color/.store in=\zerocol,
    one color/.initial=red,
    one color/.get=\onecol,
    one color/.store in=\onecol,
    cell wd/.initial=1ex,
    cell wd/.get=\cellwd,
    cell wd/.store in=\cellwd,
    cell ht/.initial=1ex,
    cell ht/.get=\cellht,
    cell ht/.store in=\cellht,
}

\newcommand{\drawgrid}[2][]{
\medskip
\begin{tikzpicture}[#1]
  \pgfplotstableforeachcolumn#2\as\col{
    \pgfplotstableforeachcolumnelement{\col}\of#2\as\colcnt{%
      \ifnum\colcnt=0
        \fill[\zerocol]($ -\pgfplotstablerow*(0,\cellht) + \col*(\cellwd,0) $) rectangle+(\cellwd,\cellht);
      \fi
      \ifnum\colcnt=1
        \fill[\onecol]($ -\pgfplotstablerow*(0,\cellht) + \col*(\cellwd,0) $) rectangle+(\cellwd,\cellht);
      \fi
    }
  }
\end{tikzpicture}
\medskip
}
\makeatother
